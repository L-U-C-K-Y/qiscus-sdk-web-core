'use strict';function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e["default"]:e}require("core-js/modules/es.array.map"),require("core-js/modules/es.function.name"),require("core-js/modules/es.object.to-string"),require("core-js/modules/es.promise"),require("core-js/modules/es.regexp.exec"),require("core-js/modules/es.string.replace");var _slicedToArray=_interopDefault(require("@babel/runtime/helpers/slicedToArray")),_classCallCheck=_interopDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass=_interopDefault(require("@babel/runtime/helpers/createClass")),derivable=require("derivable"),xs=_interopDefault(require("xstream"));require("core-js/modules/es.array.for-each"),require("core-js/modules/es.object.assign"),require("core-js/modules/es.object.keys"),require("core-js/modules/web.dom-collections.for-each");var axios=_interopDefault(require("axios"));require("core-js/modules/es.array.concat"),require("core-js/modules/es.array.find"),require("core-js/modules/es.array.reduce"),require("core-js/modules/es.array.sort"),require("core-js/modules/es.date.to-string"),require("core-js/modules/es.object.values");var _defineProperty=_interopDefault(require("@babel/runtime/helpers/defineProperty")),_objectSpread2=_interopDefault(require("@babel/runtime/helpers/objectSpread")),cuid=_interopDefault(require("cuid")),shades=require("shades");require("core-js/modules/es.array.filter"),require("core-js/modules/es.array.join"),require("core-js/modules/es.symbol"),require("core-js/modules/es.symbol.description"),require("core-js/modules/es.symbol.iterator"),require("core-js/modules/es.array.iterator"),require("core-js/modules/es.array.slice"),require("core-js/modules/es.string.iterator"),require("core-js/modules/web.dom-collections.iterator");var flatten=_interopDefault(require("lodash.flatten")),pietileEventemitter=require("pietile-eventemitter");require("core-js/modules/es.map"),require("core-js/modules/es.number.constructor"),require("core-js/modules/es.parse-int"),require("core-js/modules/es.regexp.to-string"),require("core-js/modules/es.string.split"),require("core-js/modules/es.array.every"),require("core-js/modules/es.array.index-of"),require("core-js/modules/es.array.some"),require("core-js/modules/es.regexp.constructor"),require("core-js/modules/es.string.match");var _typeof=_interopDefault(require("@babel/runtime/helpers/typeof")),_connect=_interopDefault(require("mqtt/lib/connect")),_regeneratorRuntime=_interopDefault(require("@babel/runtime/regenerator"));require("regenerator-runtime/runtime");var _asyncToGenerator=_interopDefault(require("@babel/runtime/helpers/asyncToGenerator"));require("core-js/modules/es.array.includes"),require("core-js/modules/es.string.includes");var _toConsumableArray=_interopDefault(require("@babel/runtime/helpers/toConsumableArray")),is=_interopDefault(require("is_js"));function getHttpAdapter(e){var t=e.baseUrl,s=e.httpHeader,a=e.getAppId,o=e.getUserId,r=e.getToken,n=e.getSdkVersion,i=axios.create({baseURL:t});return i.interceptors.request.use(function(e){var t={// "qiscus-sdk-app-id": getAppId(),
// "qiscus-sdk-user-id": getUserId(),
// "qiscus-sdk-token": getToken(),
// "qiscus-sdk-version": getSdkVersion(),
// "qiscus-sdk-platform": "JavaScript",
qiscus_sdk_app_id:a(),qiscus_sdk_user_id:o(),qiscus_sdk_token:r(),qiscus_sdk_version:n(),qiscus_sdk_platform:"JavaScript"},i=s.get();return null!=i&&Object.keys(i).forEach(function(e){t[e]=i[e]}),Object.assign(e.headers,t),e}),{delete:function(e,t){return i.delete(e,{data:t}).then(function(e){return e.data})},get:function(e){return i.get(e).then(function(e){return e.data})},patch:function(e,t){return i.patch(e,t).then(function(e){return e.data})},post:function(e,t){return i.post(e,t).then(function(e){return e.data})},postFormData:function(e,t){return i.post(e,t).then(function(e){return e.data})},put:function(e,t){return i.put(e,t).then(function(e){return e.data})},upload:function(e,t,s){return i.post(e,t,{onUploadProgress:function(e){var t=100*(e.loaded/e.total);s(t)}}).then(function(e){return e.data})}}}function getLogger(){var e=derivable.atom(!1),t=e.derive(function(e){return e?function(){for(var e,t=arguments.length,s=Array(t),a=0;a<t;a++)s[a]=arguments[a];return(e=console).log.apply(e,["QiscusSDK:"].concat(s))}:function(){}});return{isEnabled:e.derive(function(e){return e}),setEnable:function(t){return e.set(t)},log:t.get()}}var IQRoomType;(function(e){e.Group="group",e.Single="single"})(IQRoomType||(IQRoomType={}));var IQMessageStatus;(function(e){e.Sending="sending",e.Sent="sent",e.Delivered="delivered",e.Read="read",e.Failed="failed"})(IQMessageStatus||(IQMessageStatus={}));var IQMessageType;(function(e){e.Text="text",e.Custom="custom",e.Attachment="file_attachment"})(IQMessageType||(IQMessageType={}));function QUrlBuilder(e){var t={},s=function(e,t){return"".concat(e,"=").concat(t)};return{param:function(e,s){return t[e]=s,this},build:function(){var a=Object.keys(t).filter(function(e){return null!=t[e]}).map(function(e){return Array.isArray(t[e])?t[e].map(function(t){return s("".concat(e,"[]"),t)}).join("&"):s(e,t[e])}).join("&");return[e].concat(a).join("?")}}}var lessThanEq=function(e){return function(t){return e<=t}},getMessageType=function(e){switch(e){case"custom":return IQMessageType.Custom;case"text":default:return IQMessageType.Text;}},QMessage=/*#__PURE__*/function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"updateFromJson",value:function(e){return this.id=e.id,this.content=e.message,this.previousMessageId=e.comment_before_id,this.roomId=e.room_id,this.timestamp=new Date(e.timestamp),this.userId=e.email,this.uniqueId=e.unique_temp_id,this.extras=e.extras,this.payload=e.payload,"text"===e.type&&(this.type=IQMessageType.Text),"custom"===e.type&&(this.type=IQMessageType.Custom),"delivered"===e.status&&(this.status=IQMessageStatus.Delivered),"read"===e.status&&(this.status=IQMessageStatus.Read),this}}],[{key:"fromJson",value:function(t){return new e().updateFromJson(t)}},{key:"prepareNew",value:function(t,s,a){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:IQMessageType.Text,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},n=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{},i=new Date,d=new e;return d.content=a,d.type=o,d.status=IQMessageStatus.Sending,d.roomId=s,d.timestamp=i,d.userId=t,d.uniqueId="js-".concat(cuid()),d.extras=r,d.payload=n,d}}]),e}();function getMessageAdapter(e,t,s){var a=derivable.atom({}),o=function(e){return derivable.lens({get:function(){return Object.values(a.get()).find(function(t){return t.id===e})},set:function(e){a.update(function(t){return null!=e&&(t[e.uniqueId]=e),t})}})};return{get messages(){return a},get getMessageDataWithId(){return o},sendMessage:function(s,o){var r=t.get().currentUser.get().userId,n=QMessage.prepareNew(r,s,o.message);a.update(function(e){return _objectSpread2({},e,_defineProperty({},n.uniqueId,n))});var i=new FormData;return i.append("token",t.get().token.get()),i.append("topic_id",n.roomId+""),i.append("comment",n.content),i.append("payload",JSON.stringify(n.payload)),i.append("extras",JSON.stringify(n.extras)),e.get().postFormData("post_comment",i).then(function(e){return e.results.comment}).then(function(e){return n.updateFromJson(e),a.update(function(e){return _objectSpread2({},e,_defineProperty({},n.uniqueId,n))}),n})},getMessages:function(s){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:20,n=!!(3<arguments.length&&arguments[3]!==void 0)&&arguments[3],i=QUrlBuilder("load_comments").param("token",t.get().token.get()).param("topic_id",s).param("last_comment_id",o).param("limit",r).param("after",n).build();return e.get().get(i).then(function(e){return e.results.comments}).then(function(e){var t=e.map(function(e){return QMessage.fromJson(e)});// _messages.forEach(it => messages.update(msgs => ({ ...msgs, [it.uniqueId]: it })));
return a.update(function(e){return t.forEach(function(t){return e[t.uniqueId]=t}),e}),t})},deleteMessage:function(s){var o=QUrlBuilder("delete_messages").param("token",t.get().token.get()).param("unique_ids",s).build();return e.get().delete(o).then(function(e){return e.results.comments.map(function(e){var t=a.get()[e.unique_temp_id];return null==t?QMessage.fromJson(e):(a.update(function(t){return t[e.unique_temp_id]=void 0,t}),t)})})},markAsRead:function(r,n){var i=s.get(),d=QUrlBuilder("update_comment_status").param("token",t.get().token.get()).param("last_comment_read_id",n).param("room_id",r).build();return e.get().post(d).then(function(e){return e.results}).then(function(e){// Update participant last read comment id
var t=shades.mod("participants",shades.findBy.of({id:e.user_id})),s=t(function(t){return _objectSpread2({},t,{lastReadMessageId:e.last_comment_read_id})});i.getRoomDataWithId(r).update(s);var d=i.getRoomDataWithId(r).get(),m=d.participants.map(function(e){return e.lastReadMessageId}).sort().reduce(function(e,t){return e>t?t:e}),p=shades.mod(shades.matching({id:lessThanEq(m)})),c=p(function(e){return e.status=IQMessageStatus.Read,e});// update comment status as read
// only if all participants has read it
// Find the lowest read id or the ID which all participants has read
return a.update(c),o(n).get()})},markAsDelivered:function(r,n){var i=s.get(),d=QUrlBuilder("update_comment_status").param("token",t.get().token.get()).param("last_comment_received_id",n).param("room_id",r).build();return e.get().post(d).then(function(e){return e.results}).then(function(e){i.getRoomDataWithId(r).update(function(t){if(null==t)return t;var s=shades.mod("participants",shades.findBy.of({id:e.user_id})),a=s(function(t){return _objectSpread2({},t,{lastReceivedMessageId:e.last_comment_received_id})});return a(t)});var t=i.getRoomDataWithId(r).get();if(null==t)return null;var s=t.participants.map(function(e){return e.lastReceivedMessageId}).sort().reduce(function(e,t){return e>t?t:e});return a.update(function(e){var t=shades.mod(shades.matching({id:lessThanEq(s)})),a=function(e){return _objectSpread2({},e,{status:IQMessageStatus.Delivered})},o=t(a),r=o(e);return r}),o(n).get()})}}}function getSyncAdapter(e,t,s,a){var o=new pietileEventemitter.EventEmitter,r=0,n=0;return{synchronize:function(t){t=t||r;var s=QUrlBuilder("sync").param("token",a.get()).param("last_received_comment_id",t).build();e.get().get(s).then(function(e){var t=e.results,s=t.comments;r=t.meta.last_received_comment_id,o.emit("last-message-id",r),s.map(function(e){return _objectSpread2({},e,{status:"read",user_id:e.email})}).map(function(e){return QMessage.fromJson(e)}).forEach(function(e){return o.emit("message.new",e)})},function(e){console.log("SyncAdapter:","error when synchronize",e)})},synchronizeEvent:function(t){t=t||n;var s=QUrlBuilder("sync_event").param("token",a.get()).param("start_event_id",t).build();e.get().get(s).then(function(e){var t=e.events,s=t.map(function(e){return e.id}).slice().sort(function(e,t){return e-t}).pop();null!=s&&(n=s,o.emit("last-event-id",n));var a=!0,r=!1,i=void 0;try{for(var d,m,p=t[Symbol.iterator]();!(a=(d=p.next()).done);a=!0)m=d.value,"delivered"===m.action_topic&&o.emit("message.delivered",m.payload.data),"read"===m.action_topic&&o.emit("message.read",m.payload.data),"deleted_message"===m.action_topic&&o.emit("message.deleted",m.payload.data),"clear_room"===m.action_topic&&o.emit("room.cleared",m.payload.data)}catch(e){r=!0,i=e}finally{try{a||null==p.return||p.return()}finally{if(r)throw i}}})},onNewMessage:function(e){return o.on("message.new",e),function(){return o.off("message.new",e)}},onMessageDelivered:function(e){var t=function(t){e(t.room_id,t.email,t.comment_id,t.comment_unique_id)};return o.on("message.delivered",t),function(){return o.off("message.delivered",t)}},onMessageRead:function(e){var t=function(t){e(t.room_id,t.email,t.comment_id,t.comment_unique_id)};return o.on("message.read",t),function(){return o.off("message.read",t)}},onMessageDeleted:function(e){var s=t.get(),a=s.messages.get(),r=function(t){var s=t.deleted_messages.map(function(e){return e.message_unique_ids.map(function(e){return a[e]})});flatten(s).forEach(function(t){return e(t)})};return o.on("message.deleted",r),function(){return o.off("message.deleted",r)}},onRoomCleared:function(e){var t=s.get(),a=t.rooms.get(),r=function(t){t.deleted_rooms.map(function(e){return a[e.id]}).forEach(function(t){return e(t)})};return o.on("room.cleared",r),function(){return o.off("room.cleared",r)}}}}// Taken from https://github.com/FGRibreau/match-when/blob/master/match.js
// @ts-ignore
// import Symbol from "es6-symbol";
var _catchAllSymbol=Symbol("match.pattern.catchAll"),_patternOR=Symbol("match.pattern.OR"),_patternORStr=_patternOR.toString(),_patternAND=Symbol("match.pattern.AND"),_patternANDStr=_patternAND.toString(),_patternRANGE=Symbol("match.pattern.RANGE"),_patternRANGEStr=_patternRANGE.toString(),_patternREGEXP=Symbol("match.pattern.REGEXP"),_patternREGEXPStr=_patternREGEXP.toString(),EXTRACT_PATTERN_AND_FLAGS=/\/(.*)\/(.*)/;function MissingCatchAllPattern(){Error.call(this,"Missing when() catch-all pattern as last match argument, add [when()]: void 0"),"stack"in this||(this.stack=new Error().stack)}MissingCatchAllPattern.prototype=Object.create(Error.prototype);function match(){var e,t=(e=arguments.length-1,0>e||arguments.length<=e?void 0:arguments[e]),s=[];for(var a in t)s.push(when.unserialize(a,t[a]));// Since JS objects are unordered we need to reorder what for..in give us even if the order was already right
// because it depends on the JS engine implementation. See #2
s.sort(function(e,t){return e.position<t.position?-1:1}),-1!==Object.getOwnPropertySymbols(t).indexOf(_catchAllSymbol)&&s.push(when.unserialize(_catchAllSymbol,t[_catchAllSymbol]));var o=function(e){var t=s.find(function(t){return t.match(e)});if(!t)throw new MissingCatchAllPattern;return"function"==typeof t.result?t.result(e):t.result};return 2===arguments.length?o(0>=arguments.length?void 0:arguments[0]):o}function when(e){return void 0===e?_catchAllSymbol:e instanceof RegExp?_serialize([_patternREGEXP.toString(),e.toString()]):_serialize(e)}when.__uid=0;// Any -> String
function _serialize(e){return JSON.stringify([when.__uid++,e])}// String -> [Number, Any]
function _unserialize(e){return JSON.parse(e)}function _true(){return!0}// Any -> String
function _match(e){function t(e,t){// Implement array matching
if(Array.isArray(t))// @todo yes this is a quick and dirty way, optimize this
return JSON.stringify(e)===JSON.stringify(t);if(e instanceof RegExp)return e.test(t);if("object"===_typeof(t)){for(var s in e)if(t[s]!==e[s])return!1;return!0}return e===t}if(Array.isArray(e)){if(e[0]===_patternORStr)return e.shift(),function(s){return e[0].some(function(e){return t(e,s)})};if(e[0]===_patternANDStr)return e.shift(),function(s){return e[0].every(function(e){return t(e,s)})};if(e[0]===_patternRANGEStr)return e.shift(),function(t){return e[0]<=t&&t<=e[1]};if(e[0]===_patternREGEXPStr){var s=EXTRACT_PATTERN_AND_FLAGS.exec(e[1]);return t.bind(null,new RegExp(s[1],s[2]))}}return function(s){return t(e,s)}}// Mixed -> String
when.or=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return _serialize([_patternOR.toString(),t])},when.and=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return _serialize([_patternAND.toString(),t])},when.range=function(e,t){return _serialize([_patternRANGE.toString(),e,t])},when.unserialize=function(e,t){if(e===_catchAllSymbol)return{match:_true,result:t,position:1/0};// Const {position, matcherConfiguration} = _unserialize(serializedKey);
var s=_unserialize(e),a=s[1],o=s[0];return{match:_match(a),result:t,position:o}};var reNewMessage=/^([\w]+)\/c/i,reNotification=/^([\w]+)\/n/i,reTyping=/^r\/([\d]+)\/([\d]+)\/([\S]+)\/t$/i,reDelivery=/^r\/([\d]+)\/([\d]+)\/([\S]+)\/d$/i,reRead=/^r\/([\d]+)\/([\d]+)\/([\S]+)\/r$/i,reOnlineStatus=/^u\/([\S]+)\/s$/i,reChannelMessage=/^([\S]+)\/([\S]+)\/c/i,reCustomEvent=/^r\/[\w]+\/[\w]+\/e$/i,getMqttHandler=function(e){return{channelMessageHandler:function(t){return function(s){var a=reChannelMessage.exec(t),o=a[2],r=JSON.parse(s);e.emit("channel-message::new",{channelUniqueId:o,message:r})}},customEventHandler:function(t){return function(s){var a=reCustomEvent.exec(t),o=a[1],r=JSON.parse(s);e.emit("custom-event",{roomId:o,payload:r})}},notificationHandler:function(){return function(t){var s=JSON.parse(t);if("delete_message"===s.action_topic){var a=s.payload.data.deleted_messages;a.forEach(function(t){var s=parseInt(t.room_id,10);t.message_unique_ids.forEach(function(t){e.emit("message::deleted",{roomId:s,uniqueId:t})})})}if("clear_room"===s.action_topic){console.log("got another notification",t);var o=s.payload.data.deleted_rooms;o.forEach(function(t){var s=t.id;e.emit("room::cleared",s)})}}},onlineHandler:function(t){return function(s){var a=reOnlineStatus.exec(t),o=s.split(":"),r=a[1],n=1===+o[0],i=new Date(+o[1]);e.emit("user::presence",{userId:r,isOnline:n,lastSeen:i})}},deliveredHandler:function(t){return function(s){var a=reDelivery.exec(t),o=s.split(":"),r=parseInt(a[1],10),n=a[3],i=o[0],d=o[1];e.emit("message::delivered",{roomId:r,userId:n,messageId:i,messageUniqueId:d})}},newMessage:function(){return function(t){var s=JSON.parse(t);e.emit("message::received",{message:s})}},readHandler:function(t){return function(s){var a=reRead.exec(t),o=parseInt(a[1],10),r=a[3],n=s.split(":"),i=n[0],d=n[1];e.emit("message::read",{roomId:o,userId:r,messageId:i,messageUniqueId:d})}},typingHandler:function(t){return function(s){var a=reTyping.exec(t),o=parseInt(a[1],10),r=a[3];e.emit("user::typing",{roomId:o,userId:r,isTyping:1===+s})}}}};function getMqttAdapter(e,t){var s,a=new pietileEventemitter.EventEmitter,o=getMqttHandler(a),r=new Map,n=function(e){return"r/".concat(e,"/").concat(e,"/e")},i=function(){for(var e,t=arguments.length,s=Array(t),a=0;a<t;a++)s[a]=arguments[a];return(e=console).log.apply(e,["MqttAdapter:"].concat(s))},d=match((s={},_defineProperty(s,when(reNewMessage),function(e){return o.newMessage(e)}),_defineProperty(s,when(reNotification),function(e){return o.notificationHandler(e)}),_defineProperty(s,when(reTyping),function(e){return o.typingHandler(e)}),_defineProperty(s,when(reDelivery),function(e){return o.deliveredHandler(e)}),_defineProperty(s,when(reRead),function(e){return o.readHandler(e)}),_defineProperty(s,when(reOnlineStatus),function(e){return o.onlineHandler(e)}),_defineProperty(s,when(reChannelMessage),function(e){return o.channelMessageHandler(e)}),_defineProperty(s,when(reCustomEvent),function(e){return o.customEventHandler(e)}),_defineProperty(s,when(),function(e){return function(t){return i("topic not handled",e,t)}}),s)),m=derivable.atom(null);return a.on("custom-event",function(e){var t=e.roomId;if(r.has(t)){var s=r.get(t);s(e.payload)}}),{get mqtt(){return m.get()},connect:function(e){var s=_connect(t.get(),{will:{topic:"u/".concat(e,"/s"),payload:0,retain:0}});m.set(s),s.on("message",function(e,t){t=t.toString();var s=d(e);null!=s&&s(t)}),s.on("connect",function(){a.emit("mqtt::connected")}),s.on("reconnect",function(){a.emit("mqtt::reconnecting")}),s.on("close",function(){a.emit("mqtt::disconnected")})},onMqttConnected:function(e){return a.on("mqtt::connected",e),function(){return a.off("mqtt::connected",e)}},onMqttReconnecting:function(e){return a.on("mqtt::reconnecting",e),function(){return a.off("mqtt::reconnecting",e)}},onMqttDisconnected:function(e){return a.on("mqtt::disconnected",e),function(){return a.off("mqtt::disconnected",e)}},onMessageDeleted:function(e){return a.on("message::deleted",e),function(){return a.off("message::deleted",e)}},onMessageDelivered:function(e){return a.on("message::delivered",e),function(){return a.off("message::delivered",e)}},onMessageRead:function(e){var t=function(t){e(t.roomId,t.userId,t.messageId,t.messageUniqueId)};return a.on("message::read",t),function(){return a.off("message::read",t)}},onNewChannelMessage:function(e){return a.on("channel-message::new",e),function(){return a.off("channel-message::new",e)}},onNewMessage:function(e){var t=function(t){e(QMessage.fromJson(t.message))};return a.on("message::received",t),function(){return a.off("message::received",t)}},onRoomDeleted:function(e){return a.on("room::cleared",e),function(){return a.off("room::cleared",e)}},onUserPresence:function(e){var t=function(t){e(t.userId,t.isOnline,t.lastSeen)};return a.on("user::presence",t),function(){return a.off("user::presence",t)}},onUserTyping:function(e){var t=function(t){e(t.userId,t.roomId,t.isTyping)};return a.on("user::typing",t),function(){return a.off("user::typing",t)}},publishCustomEvent:function(e,t,s){var a=JSON.stringify({sender:t,data:s});m.get().publish(n(e),a)},subscribeCustomEvent:function(e,t){var s=n(e);r.has(e)||(m.get().subscribe(s),r.set(e,t))},unsubscribeCustomEvent:function(e){var t=n(e);r.has(e)&&(m.get().unsubscribe(t),r.delete(e))},sendPresence:function(e,t){var s=t?"1":"0";m.get().publish("u/".concat(e,"/s"),s,{retain:!0})},sendTyping:function(e,t,s){var a=s?"1":"0";m.get().publish("r/".concat(e,"/").concat(e,"/").concat(t,"/t"),a)},subscribeUser:function(e){return m.get().subscribe("".concat(e,"/c")).subscribe("".concat(e,"/n")),function(){return m.get().unsubscribe("".concat(e,"/c")).unsubscribe("".concat(e,"/n"))}},subscribeUserPresence:function(e){m.get().subscribe("u/".concat(e,"/s"))},unsubscribeUserPresence:function(e){m.get().unsubscribe("u/".concat(e,"/s"))},subscribeRoom:function(e){m.get().subscribe("r/".concat(e,"/").concat(e,"/+/t")).subscribe("r/".concat(e,"/").concat(e,"/+/d")).subscribe("r/".concat(e,"/").concat(e,"/+/r"))},unsubscribeRoom:function(e){m.get().unsubscribe("r/".concat(e,"/").concat(e,"/+/t")).unsubscribe("r/".concat(e,"/").concat(e,"/+/d")).unsubscribe("r/".concat(e,"/").concat(e,"/+/r"))},subscribeChannel:function(e,t){m.get().subscribe("".concat(e,"/").concat(t,"/c"))},unsubscribeChannel:function(e,t){m.get().unsubscribe("".concat(e,"/").concat(t,"/c"))}}}var toPromise=function(e){return new Promise(function(t,s){var a=null;e.subscribe({next:function(e){a=e},error:function(e){s(e)},complete:function(){t(a)}})})},toCallback=function(e){return function(t){var s=null,a=t.subscribe({next:function(e){s=e},error:function(t){e(null,t)},complete:function(){e(s),a.unsubscribe()}})}},toCallbackOrPromise=function(e){return function(t){return null==e?toPromise(t):toCallback(e)(t)}},tryCatch=function(e,t){try{e()}catch(e){t(e)}},process=function(e){for(var t=arguments.length,s=Array(1<t?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];return xs.create({start:function(t){s.forEach(function(s){tryCatch(function(){var a=s(e);t.next(a),t.complete()},function(e){return t.error(e)})})},stop:function(){}})},tap=function(e,t,s){return function(a){var o=null;return xs.create({start:function(r){o=a.subscribe({next:function(t){null!=e&&e(t),r.next(t)},error:function(e){null!=t&&t(e),r.error(e)},complete:function(){null!=s&&s(),r.complete()}})},stop:function(){null!=o&&o.unsubscribe()}})}},sleep=function(e){return new Promise(function(t){return setTimeout(t,e)})},bufferUntil=function(e){return function(t){var s,a=[];return xs.create({start:function(o){s=t.subscribe({next:function(t){for(a.push(t);e()&&a.length;){var s=a.shift();o.next(s)}},error:function(e){return o.error(e)},complete:function(){var t=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function t(){return _regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!a.length){t.next=6;break}return e()&&o.next(a.shift()),t.next=4,sleep(300);case 4:t.next=0;break;case 6:o.complete();case 7:case"end":return t.stop();}},t)}));return function(){return t.apply(this,arguments)}}()})},stop:function(){s&&s.unsubscribe()}})}},subscribeOnNext=function(e){return function(t){return t.subscribe({next:function(t){return e(t)}})}},toEventSubscription=function(e){return function(t){var s=null,a=null;return s=t.subscribe({next:function(t){a=e(t)}}),function(){s.unsubscribe(),a()}}};function fromSync(e){var t=null;return xs.create({start:function(s){t=e(function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];s.next([].concat(t))})},stop:function(){t()}})}function getRealtimeAdapter(e,t,s,a,o,r,n,i){var d=derivable.atom(!1),m=getSyncAdapter(e,t,s,i),p=getMqttAdapter(t,o);return xs.periodic(a.get()).filter(function(){return n.get()}).filter(function(){return!d.get()||r.get()}).subscribe({next:function(){m.synchronize(),m.synchronizeEvent()}}),p.onMqttConnected(function(){return d.set(!0)}),{get mqtt(){return p},onMessageDeleted:function(e){var t=xs.merge(fromSync(m.onMessageDeleted),fromSync(p.onMessageDeleted)).compose(subscribeOnNext(function(t){var s=_slicedToArray(t,1),a=s[0];return e(a)}));return function(){return t.unsubscribe()}},onMessageDelivered:function(e){var t=xs.merge(fromSync(m.onMessageDelivered),fromSync(p.onMessageDelivered)).compose(subscribeOnNext(function(t){var s=_slicedToArray(t,4),a=s[0],o=s[1],r=s[2],n=s[3],i=QMessage.prepareNew(o,a,null,IQMessageType.Text,null,null);i.id=r,i.uniqueId=n,e(i)}));return function(){return t.unsubscribe()}},onMessageRead:function(e){var t=xs.merge(fromSync(m.onMessageRead),fromSync(p.onMessageRead)).compose(subscribeOnNext(function(t){var s=_slicedToArray(t,4),a=s[0],o=s[1],r=s[2],n=s[3],i=QMessage.prepareNew(o,a,null,IQMessageType.Text,null,null);i.id=r,i.uniqueId=n,e(i)}));return function(){return t.unsubscribe()}},onNewMessage:function(e){var s=xs.merge(fromSync(m.onNewMessage),fromSync(p.onNewMessage)).compose(tap(function(e){var s=_slicedToArray(e,1),a=s[0];t.get().markAsDelivered(a.roomId,a.id).catch(function(){})})).compose(subscribeOnNext(function(t){var s=_slicedToArray(t,1),a=s[0];return e(a)}));return function(){return s.unsubscribe()}},onPresence:function(e){var t=fromSync(p.onUserPresence).compose(subscribeOnNext(function(t){var s=_slicedToArray(t,3),a=s[0],o=s[1],r=s[2];return e(a,o,r)}));return function(){return t.unsubscribe()}},onRoomCleared:function(e){var t=fromSync(m.onRoomCleared).compose(subscribeOnNext(function(t){var s=_slicedToArray(t,1),a=s[0];return e(a.id)}));return function(){return t.unsubscribe()}},onTyping:function(e){var t=fromSync(p.onUserTyping).compose(subscribeOnNext(function(t){var s=_slicedToArray(t,3),a=s[0],o=s[1],r=s[2];return e(a,o,r)}));return function(){return t.unsubscribe()}},sendPresence:function(e,t){p.sendPresence(e,t)},sendTyping:function(e,t,s){p.sendTyping(e,t,s)},synchronize:function(e){m.synchronize(e)},synchronizeEvent:function(e){m.synchronizeEvent(e)}}}var QParticipant=/*#__PURE__*/function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"updateFromJson",value:function(e){return this.id=e.id,this.avatarUrl=e.avatar_url,this.displayName=e.username,this.lastReadMessageId=e.last_comment_read_id,this.lastReceivedMessageId=e.last_comment_received_id,this.userId=e.email,this}}],[{key:"fromJson",value:function(t){return new e().updateFromJson(t)}}]),e}(),QRoom=/*#__PURE__*/function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"updateFromJson",value:function(e){return this.avatarUrl=e.avatar_url,this.isChannel=e.is_public_channel,this.id=e.id,this.lastMessageContent=e.last_comment_message,this.lastMessageId=e.last_comment_id,this.name=e.room_name,this.uniqueId=e.unique_id,this.unreadCount=e.unread_count,null!=e.participants&&(this.participants=e.participants.map(function(e){return QParticipant.fromJson(e)})),null!=e.room_total_participants&&(this.totalParticipants=e.room_total_participants),null!=e.options&&(this.options=e.options),"single"===e.chat_type&&(this.type=IQRoomType.Single),"group"===e.chat_type&&(this.type=IQRoomType.Group),this}}],[{key:"fromJson",value:function(t){return new e().updateFromJson(t)}},{key:"emptyRoom",value:function(){return e.fromJson({avatar_url:"",is_public_channel:!1,id:-1,last_comment_id:-1,last_comment_message:"",room_name:"",unique_id:"",unread_count:-1,participants:[],chat_type:"",options:"{}",room_total_participants:-1})}}]),e}();function getRoomAdapter(e,t){var s=derivable.atom({}),a=function(e){return derivable.lens({get:function(){return s.get()[e]},set:function(e){s.update(function(t){return null!=e&&(t[e.id]=e),t})}})},o=function(e){return derivable.lens({get:function(){return Object.values(s.get()).find(function(t){return t.uniqueId===e})},set:function(e){s.update(function(t){return null!=e&&(t[e.id]=e),t})}})};return{get rooms(){return s},get getRoomDataWithId(){return a},get getRoomDataWithUniqueId(){return o},addParticipants:function(){var s=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function s(o,r){var n,i,d;return _regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=new FormData,n.append("token",t.get().token.get()),n.append("room_id",o+""),r.forEach(function(e){return n.append("emails[]",e)}),s.next=6,e.get().postFormData("add_room_participants",n);case 6:return i=s.sent,d=i.results.participants_added.map(QParticipant.fromJson),a(o).update(function(e){return null==e?e:(e.participants=[].concat(_toConsumableArray(e.participants),_toConsumableArray(d)),e.totalParticipants=e.participants.length,e)}),s.abrupt("return",d);case 10:case"end":return s.stop();}},s)}));return function(){return s.apply(this,arguments)}}(),removeParticipants:function(){var s=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function s(o,r){var n,i,d,m,p,c;return _regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=new FormData,n.append("token",t.get().token.get()),n.append("room_id",o+""),r.forEach(function(e){return n.append("emails[]",e)}),s.next=6,e.get().postFormData("remove_room_participants",n);case 6:if(i=s.sent,d=i.results.participants_removed,m=a(o),p=m.get(),null==p){s.next=16;break}return c=d.map(function(e){return p.participants.find(function(t){return t.userId===e})}).filter(function(e){return null!=e}),m.update(function(e){return null==e?e:(e.participants=e.participants.filter(function(e){return d.includes(e.userId)}),e.totalParticipants=e.participants.length,e)}),s.abrupt("return",c);case 16:return s.abrupt("return",d.map(function(e){var t=new QParticipant;return t.userId=e,t}));case 17:case"end":return s.stop();}},s)}));return function(){return s.apply(this,arguments)}}(),chatUser:function(){var s=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function s(o,r){var n,i;return _regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,e.get().post("get_or_create_room_with_target",{token:t.get().token.get(),emails:[o],options:r});case 2:return n=s.sent,i=QRoom.fromJson(n.results.room),a(i.id).update(function(e){return _objectSpread2({},e,{},i)}),s.abrupt("return",i);case 6:case"end":return s.stop();}},s)}));return function(){return s.apply(this,arguments)}}(),clearRoom:function(){var s=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function s(a){var o,r;return _regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return o=QUrlBuilder("clear_room_messages").param("token",t.get().token.get()).param("room_channel_ids",a).build(),s.next=3,e.get().delete(o);case 3:return r=s.sent,s.abrupt("return",r.results.rooms.map(function(e){return QRoom.fromJson(e)}));case 5:case"end":return s.stop();}},s)}));return function(){return s.apply(this,arguments)}}(),createGroup:function(){var s=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function s(o,r,n,i){var d,m;return _regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,e.get().post("create_room",{token:t.get().token.get(),name:o,participants:r,avatar_url:n,options:i});case 2:return d=s.sent,m=QRoom.fromJson(d.results.room),a(m.id).set(m),s.abrupt("return",m);case 6:case"end":return s.stop();}},s)}));return function(){return s.apply(this,arguments)}}(),getChannel:function(){var s=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function s(o,r,n,i){var d,m;return _regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,e.get().post("get_or_create_room_with_unique_id",{token:t.get().token.get(),unique_id:o,name:r,avatar_url:n,options:i});case 2:return d=s.sent,m=QRoom.fromJson(d.results.room),a(m.id).set(m),s.abrupt("return",m);case 6:case"end":return s.stop();}},s)}));return function(){return s.apply(this,arguments)}}(),getParticipantList:function(){var s=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function s(a,o,r){var n,i,d;return _regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=QUrlBuilder("room_participants").param("token",t.get().token.get()).param("offset",o).param("room_unique_id",a).param("sorting",r).build(),s.next=3,e.get().get(n);case 3:// getRoomDataWithId(resp.results).update(room => {
//   room.participants = participants;
//   room.totalParticipants = room.participants.length;
//   return room;
// });
return i=s.sent,d=i.results.participants.map(function(e){return QParticipant.fromJson(e)}),s.abrupt("return",d);case 6:case"end":return s.stop();}},s)}));return function(){return s.apply(this,arguments)}}(),getRoom:function(){var s=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function s(o){var r,n,i;return _regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r=QUrlBuilder("get_room_by_id").param("token",t.get().token.get()).param("id",o).build(),s.next=3,e.get().get(r);case 3:return n=s.sent,i=QRoom.fromJson(n.results.room),a(o).set(i),s.abrupt("return",i);case 7:case"end":return s.stop();}},s)}));return function(){return s.apply(this,arguments)}}(),getRoomInfo:function(){var a=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function a(o,r){var n,i,d,m,p,c=arguments;return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=!!(3<c.length&&void 0!==c[3])&&c[3],i=!!(4<c.length&&void 0!==c[4])&&c[4],d=new FormData,d.append("token",t.get().token.get()),d.append("show_participants",i+""),d.append("show_removed",n+""),null!=o&&0<o.length&&o.forEach(function(e){return d.append("room_id[]",e+"")}),null!=r&&0<r.length&&r.forEach(function(e){return d.append("room_unique_id[]",e)}),a.next=10,e.get().postFormData("rooms_info",d);case 10:return m=a.sent,p=m.results.rooms_info.map(function(e){return QRoom.fromJson(_objectSpread2({},e,{last_comment_id:e.last_comment.id,last_comment_id_str:e.last_comment.id_str,last_topic_id:e.last_comment.topic_id,last_topic_id_str:e.last_comment.topic_id_str,last_comment_message:e.last_comment.message}))}),s.update(function(e){return p.forEach(function(t){return e[t.id]=t}),e}),a.abrupt("return",p);case 14:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),getRoomList:function(){var a=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function a(o,r,n,i,d){var m,p,c;return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return m=QUrlBuilder("user_rooms").param("token",t.get().token.get()).param("page",i).param("limit",d).param("show_participants",o).param("show_removed",r).param("show_empty",n).build(),a.next=3,e.get().get(m);case 3:return p=a.sent,c=p.results.rooms_info.map(function(e){return QRoom.fromJson(_objectSpread2({},e,{last_comment_message:e.last_comment.message,last_comment_id:e.last_comment.id}))}),s.update(function(e){var t=c.reduce(function(e,t){return e[t.id]=t,e},{});return _objectSpread2({},e,{},t)}),a.abrupt("return",c);case 7:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),getUnreadCount:function(){var s=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function s(){var a,o;return _regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=QUrlBuilder("total_unread_count").param("token",t.get().token.get()).build(),s.next=3,e.get().get(a);case 3:return o=s.sent,s.abrupt("return",o.results.total_unread_count);case 5:case"end":return s.stop();}},s)}));return function(){return s.apply(this,arguments)}}(),updateRoom:function(){var s=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function s(o,r,n,i){var d,m,p;return _regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return d=new FormData,d.append("token",t.get().token.get()),d.append("id",o+""),null!=r&&d.append("room_name",r),null!=n&&d.append("avatar_url",n),null!=i&&d.append("options",i),s.next=8,e.get().postFormData("update_room",d);case 8:return m=s.sent,p=QRoom.fromJson(m.results.room),a(o).set(p),s.abrupt("return",p);case 12:case"end":return s.stop();}},s)}));return function(){return s.apply(this,arguments)}}()}}//endregion
var QUser=/*#__PURE__*/function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fromJson",value:function(t){var s=new e;return s.id=t.id,s.userId=t.email,s.displayName=t.username,s.avatarUrl=t.avatar_url,s}}]),e}();function getUserAdapter(e){var t=derivable.atom(null),s=derivable.atom(null);return{login:function(){var a=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function a(o,r,n){var i,d,m,p,c,l;return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i=n.avatarUrl,d=n.extras,m=n.name,p={email:o,password:r,avatar_url:i,username:m,extras:d},a.next=4,e.get().post("login_or_register",p);case 4:return c=a.sent,l=QUser.fromJson(c.results.user),t.set(l),s.set(c.results.user.token),a.abrupt("return",l);case 9:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),clear:function(){t.set(null),s.set(null)},blockUser:function(){var t=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function t(s){var a;return _regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get().post("block_user",{token:this.token.get(),user_email:s});case 2:return a=t.sent,t.abrupt("return",QUser.fromJson(a.results.user));case 4:case"end":return t.stop();}},t,this)}));return function(){return t.apply(this,arguments)}}(),getBlockedUser:function(){var t=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function t(){var s,a,o,r,n=arguments;return _regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=0<n.length&&void 0!==n[0]?n[0]:1,a=1<n.length&&void 0!==n[1]?n[1]:20,o=QUrlBuilder("get_user_list").param("token",this.token.get()).param("page",s).param("limit",a).build(),t.next=5,e.get().get(o);case 5:return r=t.sent,t.abrupt("return",r.results.users.map(function(e){return QUser.fromJson(e)}));case 7:case"end":return t.stop();}},t,this)}));return function(){return t.apply(this,arguments)}}(),getUserList:function(){var t=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function t(){var a,o,r,n,i,d=arguments;return _regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=0<d.length&&void 0!==d[0]?d[0]:"",o=1<d.length&&void 0!==d[1]?d[1]:1,r=2<d.length&&void 0!==d[2]?d[2]:20,n=QUrlBuilder("get_user_list").param("token",s.get()).param("query",a).param("page",o).param("limit",r).build(),t.next=6,e.get().get(n);case 6:return i=t.sent,t.abrupt("return",i.results.users.map(function(e){return QUser.fromJson(e)}));case 8:case"end":return t.stop();}},t)}));return function(){return t.apply(this,arguments)}}(),unblockUser:function(){var t=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function t(s){var a;return _regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get().post("unblock_user",{token:this.token.get(),user_email:s});case 2:return a=t.sent,t.abrupt("return",QUser.fromJson(a.results.user));case 4:case"end":return t.stop();}},t,this)}));return function(){return t.apply(this,arguments)}}(),setUserFromIdentityToken:function(){var a=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function a(o){var r,n;return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.get().post("auth/verify_identity_token",{identity_token:o});case 2:return r=a.sent,n=QUser.fromJson(r.results.user),t.set(n),s.set(r.results.user.token),a.abrupt("return",n);case 7:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),updateUser:function(){var s=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function s(a,o,r){var n,i,d;return _regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n={token:this.token.get(),name:a,avatar_url:o,extras:r},s.next=3,e.get().patch("my_profile",n);case 3:return i=s.sent,d=QUser.fromJson(i.results.user),t.set(d),s.abrupt("return",d);case 7:case"end":return s.stop();}},s,this)}));return function(){return s.apply(this,arguments)}}(),getNonce:function(){var t=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function t(){var s;return _regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get().post("auth/nonce");case 2:return s=t.sent,t.abrupt("return",{expired:s.results.expired_at,nonce:s.results.nonce});case 4:case"end":return t.stop();}},t)}));return function(){return t.apply(this,arguments)}}(),getUserData:function(){var a=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function a(){var o,r,n;return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o=QUrlBuilder("my_profile").param("token",s.get()).build(),a.next=3,e.get().get(o);case 3:return r=a.sent,n=QUser.fromJson(r.results.user),t.set(n),a.abrupt("return",n);case 7:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),registerDeviceToken:function(){var t=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function t(a){var o,r,n=arguments;return _regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=1<n.length&&void 0!==n[1]?n[1]:"rn",t.next=3,e.get().post("set_user_device_token",{token:s.get(),device_platform:o,device_token:a});case 3:return r=t.sent,t.abrupt("return",r.results.changed);case 5:case"end":return t.stop();}},t)}));return function(){return t.apply(this,arguments)}}(),unregisterDeviceToken:function(){var t=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function t(a){var o,r,n=arguments;return _regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=1<n.length&&void 0!==n[1]?n[1]:"rn",t.next=3,e.get().post("remove_user_device_token",{token:s.get(),device_platform:o,device_token:a});case 3:return r=t.sent,t.abrupt("return",r.results.changed);case 5:case"end":return t.stop();}},t)}));return function(){return t.apply(this,arguments)}}(),get token(){return s},get currentUser(){return t}}}var every=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(e){return t.every(function(t){return t(e)})}},some=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(e){return t.some(function(t){return t(e)})}},compose=function(e,t){return function(s){var a=t(s);if(a)return s;throw new TypeError(e)}},getName=function(e){return Object.keys(e).shift()},getMsg=function(e,t){return"`".concat(getName(e),"` ").concat(t)},isReqString=function(e){var t=getMsg(e,"are required and need to be string");return compose(t,every(is.not.null,is.not.undefined,is.string))},isReqNumber=function(e){var t=getMsg(e,"are required and need to be number");return compose(t,every(is.not.null,is.not.undefined,is.number))},isReqJson=function(e){var t=getMsg(e,"are required and need to be object");return compose(t,every(is.not.null,is.not.undefined,is.json))},isReqArrayString=function(e){var t=getMsg(e,"are required and need to be array of string");return compose(t,every(is.not.null,is.not.undefined,is.array,is.all.string))},isReqArrayOfStringOrNumber=function(e){var t=getMsg(e,"are required and need to be array of string or array of number");return compose(t,every(is.not.null,is.not.undefined,is.array,some(is.all.number,is.all.string)))},isOptString=function(e){var t=getMsg(e,"need to be string or null");return compose(t,some(is.null,is.undefined,is.string))},isOptNumber=function(e){var t=getMsg(e,"need to be number or null");return compose(t,some(is.null,is.undefined,is.number))},isOptJson=function(e){var t=getMsg(e,"need to be object or null");return compose(t,some(is.null,is.undefined,is.json))},isOptCallback=function(e){var t=getMsg(e,"need to be function or null");return compose(t,some(is.null,is.undefined,is.function))},isOptBoolean=function(e){var t=getMsg(e,"need to be boolean or null");return compose(t,some(is.null,is.undefined,is.boolean))};function isArrayOfNumber(e){return is.all.truthy(is.array(e),is.all.number(e))}function isArrayOfString(e){return is.all.truthy(is.array(e),is.all.string(e))}var Qiscus=/*#__PURE__*/function(){function e(){_classCallCheck(this,e),this._syncMode=derivable.atom("socket"),this._realtimeAdapter=derivable.atom(null),this._loggerAdapter=derivable.atom(null),this._httpAdapter=derivable.atom(null),this._userAdapter=derivable.atom(null),this._roomAdapter=derivable.atom(null),this._messageAdapter=derivable.atom(null),this._syncInterval=derivable.atom(5e3),this._baseUrl=derivable.atom(null),this._brokerUrl=derivable.atom(null),this._appId=derivable.atom(null),this._shouldSync=derivable.atom(!1),this._customHeaders=derivable.atom(null)}//</editor-fold>
return _createClass(e,[{key:"setup",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5e3;this.setupWithCustomServer(e,"https://api.qiscus.com/api/v2/sdk/","wss://mqtt.qiscus.com:1886/mqtt",null,t)}},{key:"setupWithCustomServer",value:function(e,t,s){var a=this,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:5e3;this._appId.set(e),this._baseUrl.set(t),this._brokerUrl.set(s),this._syncMode.set("socket"),this._syncInterval.set(o),this._loggerAdapter.set(getLogger()),this._httpAdapter.set(getHttpAdapter({baseUrl:this.baseUrl,httpHeader:this._customHeaders,getAppId:function(){return a.appId},getToken:function(){return a.token},getUserId:function(){return a.currentUser?a.currentUser.userId:null},getSdkVersion:function(){return"3-alpha"}})),this._userAdapter.set(getUserAdapter(this._httpAdapter)),this._roomAdapter.set(getRoomAdapter(this._httpAdapter,this._userAdapter)),this._messageAdapter.set(getMessageAdapter(this._httpAdapter,this._userAdapter,this._roomAdapter)),this._realtimeAdapter.set(getRealtimeAdapter(this._httpAdapter,this._messageAdapter,this._roomAdapter,this._syncInterval,this._brokerUrl,this._shouldSync,this.userAdapter.token.derive(function(e){return null!=e}),this.userAdapter.token))}},{key:"setCustomHeader",value:function(e){this._customHeaders.set(e)}// User Adapter ------------------------------------------
},{key:"setUser",value:function(e,t,s,a,o,r){var n=this;// this method should set currentUser and token
return xs.combine(process(e,isReqString({userId:e})),process(t,isReqString({userKey:t})),process(s,isOptString({username:s})),process(a,isOptString({avatarUrl:a})),process(o,isOptJson({extras:o})),process(r,isOptCallback({callback:r}))).map(function(e){var t=_slicedToArray(e,5),s=t[0],a=t[1],o=t[2],r=t[3],n=t[4];return[s,a,o,r,JSON.stringify(n)]}).map(function(e){var t=_slicedToArray(e,5),s=t[0],a=t[1],o=t[2],r=t[3],i=t[4];return xs.fromPromise(n.userAdapter.login(s,a,{name:o,avatarUrl:r,extras:i}))}).flatten().compose(tap(function(e){n.realtimeAdapter.mqtt.connect(e.userId),n.realtimeAdapter.mqtt.subscribeUser(n.userAdapter.token.get())})).compose(toCallbackOrPromise(r))}},{key:"blockUser",value:function(e,t){var s=this;return xs.combine(process(e,isReqString({userId:e})),process(t,isOptCallback({callback:t}))).compose(bufferUntil(function(){return s.isLogin})).map(function(e){var t=_slicedToArray(e,1),a=t[0];return xs.fromPromise(s.userAdapter.blockUser(a))}).flatten().compose(toCallbackOrPromise(t))}},{key:"clearUser",value:function(e){var t=this;// this method should clear currentUser and token
return xs.combine(process(e,isOptCallback({callback:e}))).map(function(){return xs.fromPromise(Promise.resolve(t.userAdapter.clear()))}).flatten().compose(toCallbackOrPromise(e))}},{key:"unblockUser",value:function(e,t){var s=this;return xs.combine(process(e,isReqString({userId:e})),process(t,isOptCallback({callback:t}))).compose(bufferUntil(function(){return s.isLogin})).map(function(e){var t=_slicedToArray(e,1),a=t[0];return xs.fromPromise(s.userAdapter.unblockUser(a))}).flatten().compose(toCallbackOrPromise(t))}},{key:"updateUser",value:function(e,t,s,a){var o=this;// this method should update current user
return xs.combine(process(e,isOptString({username:e})),process(t,isOptString({avatarUrl:t})),process(s,isOptJson({extras:s})),process(a,isOptCallback({callback:a}))).map(function(e){var t=_slicedToArray(e,3),s=t[0],a=t[1],o=t[2];return[s,a,JSON.stringify(o)]}).compose(bufferUntil(function(){return o.isLogin})).map(function(e){var t=_slicedToArray(e,3),s=t[0],a=t[1],r=t[2];return xs.fromPromise(o.userAdapter.updateUser(s,a,r))}).flatten().compose(toCallbackOrPromise(a))}},{key:"getBlockedUsers",value:function(e,t,s){var a=this;return xs.combine(process(e,isOptNumber({page:e})),process(t,isOptNumber({limit:t})),process(s,isOptCallback({callback:s}))).compose(bufferUntil(function(){return a.isLogin})).map(function(e){var t=_slicedToArray(e,2),s=t[0],o=t[1];return xs.fromPromise(a.userAdapter.getBlockedUser(s,o))}).flatten().compose(toCallbackOrPromise(s))}},{key:"getUsers",value:function(e,t,s,a){var o=this;return xs.combine(process(e,isOptString({searchUsername:e})),process(t,isOptNumber({page:t})),process(s,isOptString({limit:s})),process(a,isOptCallback({callback:a}))).compose(bufferUntil(function(){return o.isLogin})).map(function(e){var t=_slicedToArray(e,3),s=t[0],a=t[1],r=t[2];return xs.fromPromise(o.userAdapter.getUserList(s,a,r))}).flatten().compose(toCallbackOrPromise(a))}},{key:"getJWTNonce",value:function(e){var t=this;return xs.combine(process(e,isOptCallback({callback:e}))).map(function(){return xs.fromPromise(t.userAdapter.getNonce())}).flatten().map(function(e){return e.nonce}).compose(toCallbackOrPromise(e))}},{key:"getUserData",value:function(e){var t=this;// this method should update current user
return xs.combine(process(e,isOptCallback({callback:e}))).compose(bufferUntil(function(){return t.isLogin})).map(function(){return xs.fromPromise(t.userAdapter.getUserData())}).flatten().compose(toCallbackOrPromise(e))}},{key:"registerDeviceToken",value:function(e,t){var s=this;return xs.combine(process(e,isReqString({token:e})),process(t,isOptCallback({callback:t}))).compose(bufferUntil(function(){return s.isLogin})).map(function(e){var t=_slicedToArray(e,1),a=t[0];return xs.fromPromise(s.userAdapter.registerDeviceToken(a))}).flatten().compose(toCallbackOrPromise(t))}},{key:"removeDeviceToken",value:function(e,t){var s=this;return xs.combine(process(e,isReqString({token:e})),process(t,isOptCallback({callback:t}))).compose(bufferUntil(function(){return s.isLogin})).map(function(e){var t=_slicedToArray(e,1),a=t[0];return xs.fromPromise(s.userAdapter.unregisterDeviceToken(a))}).flatten().compose(toCallbackOrPromise(t))}},{key:"updateChatRoom",value:function(e,t,s,a,o){var r=this;// this method should update room list
return xs.combine(process(e,isReqNumber({roomId:e})),process(t,isOptString({name:t})),process(s,isOptString({avatarUrl:s})),process(a,isOptJson({extras:a}))).map(function(e){var t=_slicedToArray(e,4),s=t[0],a=t[1],o=t[2],r=t[3];return{roomId:s,name:a,avatarUrl:o,extras:JSON.stringify(r)}}).compose(bufferUntil(function(){return r.isLogin})).map(function(e){var t=e.roomId,s=e.name,a=e.avatarUrl,o=e.extras;return xs.fromPromise(r.roomAdapter.updateRoom(t,s,a,o))}).flatten().compose(toCallbackOrPromise(o))}},{key:"setUserWithIdentityToken",value:function(e,t){var s=this;return xs.combine(process(e,isReqString({token:e})),process(t,isOptCallback({callback:t}))).map(function(e){var t=_slicedToArray(e,1),a=t[0];return xs.fromPromise(s.userAdapter.setUserFromIdentityToken(a))}).flatten().compose(toCallbackOrPromise(t))}},{key:"getChannel",value:function(e,t){var s=this;throw new Error("Method not implemented.")}// -------------------------------------------------------
// Room Adapter ------------------------------------------
},{key:"chatUser",value:function(e,t,s){var a=this;return xs.combine(process(e,isReqString({userId:e})),process(t,isOptJson({extras:t})),process(s,isOptCallback({callback:s}))).map(function(e){var t=_slicedToArray(e,2),s=t[0],a=t[1];return[s,JSON.stringify(a)]}).compose(bufferUntil(function(){return a.isLogin})).map(function(e){var t=_slicedToArray(e,2),s=t[0],o=t[1];return xs.fromPromise(a.roomAdapter.chatUser(s,o))}).flatten().compose(toCallbackOrPromise(s))}},{key:"addParticipants",value:function(e,t,s){var a=this;return xs.combine(process(e,isReqNumber({roomId:e})),process(t,isReqArrayString({userIds:t})),process(s,isOptCallback({callback:s}))).compose(bufferUntil(function(){return a.isLogin})).map(function(e){var t=_slicedToArray(e,2),s=t[0],o=t[1];return xs.fromPromise(a.roomAdapter.addParticipants(s,o))}).flatten().compose(toCallbackOrPromise(s))}// Test me
},{key:"removeParticipants",value:function(e,t,s){var a=this;return xs.combine(process(e,isReqNumber({roomId:e})),process(t,isReqArrayString({userIds:t})),process(s,isOptCallback({callback:s}))).compose(bufferUntil(function(){return a.isLogin})).map(function(e){var t=_slicedToArray(e,2),s=t[0],o=t[1];return xs.fromPromise(a.roomAdapter.removeParticipants(s,o))}).flatten().compose(toCallbackOrPromise(s))}},{key:"clearMessagesByChatRoomId",value:function(e,t){var s=this;return xs.combine(process(e,isReqArrayString({roomIds:e})),process(t,isOptCallback({callback:t}))).compose(bufferUntil(function(){return s.isLogin})).map(function(e){var t=_slicedToArray(e,1),a=t[0];return xs.fromPromise(s.roomAdapter.clearRoom(a))}).flatten().compose(toCallbackOrPromise(t))}},{key:"createGroupChat",value:function(e,t,s,a,o){var r=this;return xs.combine(process(e,isReqString({name:e})),process(t,isReqArrayString({userIds:t})),process(s,isOptString({avatarUrl:s})),process(a,isOptJson({extras:a})),process(o,isOptCallback({callback:o}))).map(function(e){var t=_slicedToArray(e,4),s=t[0],a=t[1],o=t[2],r=t[3];return{name:s,userIds:a,avatarUrl:o,extras:JSON.stringify(r)}}).compose(bufferUntil(function(){return r.isLogin})).map(function(e){var t=e.name,s=e.userIds,a=e.avatarUrl,o=e.extras;return xs.fromPromise(r.roomAdapter.createGroup(t,s,a,o))}).flatten().compose(toCallbackOrPromise(o))}},{key:"createChannel",value:function(e,t,s,a,o){var r=this;return xs.combine(process(e,isReqString({uniqueId:e})),process(t,isReqString({name:t})),process(s,isOptString({avatarUrl:s})),process(a,isOptJson({extras:a})),process(o,isOptCallback({callback:o}))).map(function(e){var t=_slicedToArray(e,4),s=t[0],a=t[1],o=t[2],r=t[3];return[s,a,o,JSON.stringify(r)]}).compose(bufferUntil(function(){return r.isLogin})).map(function(e){var t=_slicedToArray(e,4),s=t[0],a=t[1],o=t[2],n=t[3];return xs.fromPromise(r.roomAdapter.getChannel(s,a,o,n))}).flatten().compose(toCallbackOrPromise(o))}},{key:"getParticipants",value:function(e,t,s,a){var o=this;return xs.combine(process(e,isReqString({roomUniqueId:e})),process(t,isOptNumber({offset:t})),process(s,isOptString({sorting:s})),process(a,isOptCallback({callback:a}))).compose(bufferUntil(function(){return o.isLogin})).map(function(e){var t=_slicedToArray(e,3),s=t[0],a=t[1],r=t[2];return xs.fromPromise(o.roomAdapter.getParticipantList(s,a,r))}).flatten().compose(toCallbackOrPromise(a))}},{key:"getChatRooms",value:function(e,t,s,a,o){var r=this,n=null,i=null;return isArrayOfNumber(e)&&(i=e),isArrayOfString(e)&&(n=e),xs.combine(// process(roomIds, isOptArrayNumber({ roomIds })),
// process(uniqueIds, isOptArrayString({ uniqueIds })),
process(e,isReqArrayOfStringOrNumber({ids:e})),process(t,isOptNumber({page:t})),process(s,isOptBoolean({showRemoved:s})),process(a,isOptBoolean({showParticipant:a})),process(o,isOptCallback({callback:o}))).compose(bufferUntil(function(){return r.isLogin})).map(function(e){var t=_slicedToArray(e,4),s=t[0],a=t[1],o=t[2],d=t[3];return xs.fromPromise(r.roomAdapter.getRoomInfo(i,n,a,o,d))}).flatten().compose(toCallbackOrPromise(o))}},{key:"getAllChatRooms",value:function(e,t,s,a,o,r){var n=this;return xs.combine(process(e,isOptBoolean({showParticipant:e})),process(t,isOptBoolean({showRemoved:t})),process(s,isOptBoolean({showEmpty:s})),process(a,isOptNumber({page:a})),process(o,isOptNumber({limit:o})),process(r,isOptCallback({callback:r}))).compose(bufferUntil(function(){return n.isLogin})).map(function(e){var t=_slicedToArray(e,5),s=t[0],a=t[1],o=t[2],r=t[3],i=t[4];return xs.fromPromise(n.roomAdapter.getRoomList(s,a,o,r,i))}).flatten().compose(toCallbackOrPromise(r))}},{key:"getChatRoomWithMessages",value:function(e,t){var s=this;return xs.combine(process(e,isReqNumber({roomId:e})),process(t,isOptCallback({callback:t}))).compose(bufferUntil(function(){return s.isLogin})).map(function(e){var t=_slicedToArray(e,1),a=t[0];return xs.fromPromise(s.roomAdapter.getRoom(a))}).flatten().compose(toCallbackOrPromise(t))}},{key:"getTotalUnreadCount",value:function(e){var t=this;return xs.combine(process(e,isOptCallback({callback:e}))).compose(bufferUntil(function(){return t.isLogin})).map(function(){return xs.fromPromise(t.roomAdapter.getUnreadCount())}).flatten().compose(toCallbackOrPromise(e))}// ------------------------------------------------------
// Message Adapter --------------------------------------
},{key:"sendMessage",value:function(e,t,s){var a=this;return xs.combine(process(e,isReqNumber({roomId:e})),process(t,isReqJson({message:t})),process(s,isOptCallback({callback:s}))).compose(bufferUntil(function(){return a.isLogin})).compose(tap(function(e){var t=_slicedToArray(e,2),s=t[0],o=t[1],r=QMessage.prepareNew(a.currentUser.userId,s,o.message,getMessageType(o.type),o.extras,o.payload);r.status=IQMessageStatus.Sending})).map(function(e){var t=_slicedToArray(e,2),s=t[0],o=t[1];return xs.fromPromise(a.messageAdapter.sendMessage(s,o))}).flatten().compose(toCallbackOrPromise(s))}},{key:"markAsDelivered",value:function(e,t,s){var a=this;return xs.combine(process(e,isReqNumber({roomId:e})),process(t,isReqNumber({messageId:t})),process(s,isOptCallback({callback:s}))).compose(bufferUntil(function(){return a.isLogin})).map(function(e){var t=_slicedToArray(e,2),s=t[0],o=t[1];return xs.fromPromise(a.messageAdapter.markAsDelivered(s,o))}).flatten().compose(toCallbackOrPromise(s))}},{key:"markAsRead",value:function(e,t,s){var a=this;return xs.combine(process(e,isReqNumber({roomId:e})),process(t,isReqNumber({messageId:t})),process(s,isOptCallback({callback:s}))).compose(bufferUntil(function(){return a.isLogin})).map(function(e){var t=_slicedToArray(e,2),s=t[0],o=t[1];return xs.fromPromise(a.messageAdapter.markAsRead(s,o))}).flatten().compose(toCallbackOrPromise(s))}},{key:"deleteMessages",value:function(e,t){var s=this;return xs.combine(process(e,isReqArrayString({messageUniqueIds:e})),process(t,isOptCallback({callback:t}))).compose(bufferUntil(function(){return s.isLogin})).map(function(e){var t=_slicedToArray(e,1),a=t[0];return xs.fromPromise(s.messageAdapter.deleteMessage(a))}).flatten().compose(toCallbackOrPromise(t))}},{key:"getPreviouseMessagesById",value:function(e,t,s,a){var o=this;return xs.combine(process(e,isReqNumber({roomId:e})),process(t,isOptNumber({limit:t})),process(s,isOptNumber({messageId:s})),process(a,isOptCallback({callback:a}))).compose(bufferUntil(function(){return o.isLogin})).map(function(e){var t=_slicedToArray(e,3),s=t[0],a=t[1],r=t[2];return xs.fromPromise(o.messageAdapter.getMessages(s,r,a,!1))}).flatten().compose(toCallbackOrPromise(a))}},{key:"getNextMessagesById",value:function(e,t,s,a){var o=this;return xs.combine(process(e,isReqNumber({roomId:e})),process(t,isOptNumber({limit:t})),process(s,isOptNumber({messageId:s})),process(a,isOptCallback({callback:a}))).compose(bufferUntil(function(){return o.isLogin})).map(function(e){var t=_slicedToArray(e,3),s=t[0],a=t[1],r=t[2];return xs.fromPromise(o.messageAdapter.getMessages(s,r,a,!0))}).flatten().compose(toCallbackOrPromise(a))}// -------------------------------------------------------
// Misc --------------------------------------------------
},{key:"publishCustomEvent",value:function(e,t){var s=this.currentUser.userId;this.realtimeAdapter.mqtt.publishCustomEvent(e,s,t)}},{key:"publishOnlinePresence",value:function(e){this.realtimeAdapter.sendPresence(this.currentUser.userId,e)}},{key:"publishTyping",value:function(e,t){this.realtimeAdapter.sendTyping(e,this.currentUser.userId,t||!0)}},{key:"subscribeCustomEvent",value:function(e,t){this.realtimeAdapter.mqtt.subscribeCustomEvent(e,t)}},{key:"unsubscribeCustomEvent",value:function(e){this.realtimeAdapter.mqtt.unsubscribeCustomEvent(e)}},{key:"upload",value:function(e,t){var s=new FormData;s.append("file",e),s.append("token",this.token),this.httpAdapter.upload("upload",s,function(e){return t(null,e)}).then(function(e){var s=e.results.file.url;t(null,null,s)}).catch(function(e){return t(e)})}},{key:"hasSetupUser",value:function(e){return xs.of(this.currentUser).map(function(e){return null!=e}).compose(toCallbackOrPromise(e))}},{key:"sendFileMessage",value:function(e,t,s,a){var o=this;this.upload(s,function(r,n,i){if(r)return a(r);if(n&&a(null,n),i){var d={payload:{url:i,file_name:s.name,size:s.size,caption:t},extras:{},type:IQMessageType.Attachment,message:"[file] ".concat(i," [/file]")};o.sendMessage(e,d,function(e){a(null,null,e)})}})}},{key:"getThumbnailURL",value:function(e){return e.replace("/upload/","/upload/w_30,c_scale/")}},{key:"setSyncInterval",value:function(e){this._syncInterval.set(e)}},{key:"synchronize",value:function(e){this.realtimeAdapter.synchronize(e)}},{key:"synchronizeEvent",value:function(e){this.realtimeAdapter.synchronizeEvent(e)}},{key:"enableDebugMode",value:function(e){this._loggerAdapter.get().setEnable(e)}},{key:"onMessageReceived",value:function(e){var t=this;return xs.of(e).compose(bufferUntil(function(){return t.isLogin})).compose(toEventSubscription(this.realtimeAdapter.onNewMessage))}},{key:"onMessageDeleted",value:function(e){var t=this;return xs.of(e).compose(bufferUntil(function(){return t.isLogin})).compose(toEventSubscription(this.realtimeAdapter.onMessageDeleted))}},{key:"onMessageDelivered",value:function(e){var t=this;return xs.of(e).compose(bufferUntil(function(){return t.isLogin})).compose(toEventSubscription(this.realtimeAdapter.onMessageDelivered))}},{key:"onMessageRead",value:function(e){var t=this;return xs.of(e).compose(bufferUntil(function(){return t.isLogin})).compose(toEventSubscription(this.realtimeAdapter.onMessageRead))}},{key:"onUserTyping",value:function(e){var t=this;return xs.of(e).compose(bufferUntil(function(){return t.isLogin})).compose(toEventSubscription(this.realtimeAdapter.onTyping))}},{key:"onUserOnlinePresence",value:function(e){var t=this;return xs.of(e).compose(bufferUntil(function(){return t.isLogin})).compose(toEventSubscription(this.realtimeAdapter.onPresence))}},{key:"onChatRoomCleared",value:function(e){var t=this;return xs.of(e).compose(bufferUntil(function(){return t.isLogin})).compose(toEventSubscription(this.realtimeAdapter.onRoomCleared))}},{key:"onConnected",value:function(e){var t=this;return xs.of(e).compose(bufferUntil(function(){return t.isLogin})).compose(toEventSubscription(this.realtimeAdapter.mqtt.onMqttConnected))}},{key:"onReconnecting",value:function(e){var t=this;return xs.of(e).compose(bufferUntil(function(){return t.isLogin})).compose(toEventSubscription(this.realtimeAdapter.mqtt.onMqttReconnecting))}},{key:"onDisconnected",value:function(e){var t=this;return xs.of(e).compose(bufferUntil(function(){return t.isLogin})).compose(toEventSubscription(this.realtimeAdapter.mqtt.onMqttDisconnected))}},{key:"subscribeChatRoom",value:function(e){var t=this;xs.of([e]).compose(bufferUntil(function(){return t.isLogin})).compose(subscribeOnNext(function(e){var s=_slicedToArray(e,1),a=s[0];a.isChannel?t.realtimeAdapter.mqtt.subscribeChannel(t.appId,a.uniqueId):t.realtimeAdapter.mqtt.subscribeRoom(a.id)}))}},{key:"unsubscribeChatRoom",value:function(e){var t=this;xs.of([e]).compose(bufferUntil(function(){return t.isLogin})).compose(subscribeOnNext(function(e){var s=_slicedToArray(e,1),a=s[0];a.isChannel?t.realtimeAdapter.mqtt.subscribeChannel(t.appId,a.uniqueId):t.realtimeAdapter.mqtt.subscribeRoom(a.id)}))}},{key:"subscribeUserOnlinePresence",value:function(e){var t=this;xs.of([e]).compose(bufferUntil(function(){return t.isLogin})).compose(subscribeOnNext(function(e){var s=_slicedToArray(e,1),a=s[0];return t.realtimeAdapter.mqtt.subscribeUserPresence(a)}))}},{key:"unsubscribeUserOnlinePresence",value:function(e){var t=this;xs.of([e]).compose(bufferUntil(function(){return t.isLogin})).compose(subscribeOnNext(function(e){var s=_slicedToArray(e,1),a=s[0];return t.realtimeAdapter.mqtt.unsubscribeUserPresence(a)}))}},{key:"httpAdapter",get:function(){return this._httpAdapter.get()}},{key:"realtimeAdapter",get:function(){return this._realtimeAdapter.get()}},{key:"userAdapter",get:function(){return this._userAdapter.get()}},{key:"roomAdapter",get:function(){return this._roomAdapter.get()}},{key:"messageAdapter",get:function(){return this._messageAdapter.get()}},{key:"appId",get:function(){return this._appId.get()}},{key:"baseUrl",get:function(){return this._baseUrl.get()}},{key:"brokerUrl",get:function(){return this._brokerUrl.get()}},{key:"token",get:function(){return this.userAdapter.token.get()}},{key:"isLogin",get:function(){return null!=this.currentUser}},{key:"currentUser",get:function(){return this._userAdapter.derive(function(e){return e.currentUser.get()}).get()}},{key:"syncInterval",get:function(){return this._syncInterval.get()}},{key:"shouldSync",get:function(){return this._shouldSync.get()}}],[{key:"instance",get:function(){return null==this._instance&&(this._instance=new this),this._instance}}]),e}();Qiscus._instance=null,module.exports=Qiscus;
//# sourceMappingURL=qiscus-sdk-javascript.min.js.map
